'use strict';
$(function() {

	$("#roleName").get(0).focus();
    // ================================ 变量声明 ================================ //
    // ContextPath
    var sContextPath = _.CONTEXT_PATH;
   
  //获取id
    var nId = function() {
        if (location.pathname !== _.resolvePath(sContextPath, 'role')){
            var aslocatoin = location.pathname.split("/");
            // 获取 id
            return aslocatoin[aslocatoin.length - 1];
        }
    }();
    
    function initializePage() {
    	
        // VALIDATION 验证
        var oValidationOption = _.VALIDATION_OPTIONS;
        oValidationOption.rules = {
        	roleName: {
                required: true,
                chineseAlphabet: true
            }

            
        };	

        $('#roleForm').validate(oValidationOption);        
        

        $('#saveBtn').click(function() {
            // 验证失败,则返回
            if (!$('#roleForm').valid()) {
                return false;
            }

            // 提交至后台,根据url进行区分
            var sUrl = _.resolvePath(sContextPath, 'api/role');
            var fMethod = $.post;
            if (nId != null) {
                sUrl = _.resolvePath(sContextPath, 'api/role', nId);
                fMethod = $.put;
            }
            fMethod(sUrl, $('#roleForm').serializeJSON()).done(function() {
                back();
            });
        })
        
         $('#createBtn').click(function() {
        	 _.route(_.resolvePath(sContextPath, 'role', nId));
        })

        $('#backBtn').click(function() {
            back();
        });

    }
    // 跳回一览画面
    function back(){

       _.route(_.resolvePath(sContextPath, 'roles'));

       
    }

    // 画面初期数据取得
    function getPageData() {
        if (nId != null) {
            var sUrl = _.resolvePath(sContextPath, 'api/role', nId);
            $.get(sUrl).done(function(oData) {
                $('#roleName').val(oData.roleName);
                $('#updDate').val(oData.updDate);
                var aoDataList = oData.roleAuthorityList;
                var nDataListLen = aoDataList.length;
                for(var i = 0; i < nDataListLen; i++){
                    var sCheckboxList = '#roleAuthority' + aoDataList[i];
                    $(sCheckboxList).prop('checked', true);
                }
            });
        }
    }

    // 画面初期化
    function onPageLoad() {

        // 画面初期事件绑定及JS插件渲染
        initializePage();

        // 画面初期数据取得
        getPageData();
    }

    // ================================ 方法调用 ================================ //
    // 画面初期化
    onPageLoad();
});
