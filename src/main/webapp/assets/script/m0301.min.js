'use strict';
$(function() {

    // ================================ 变量声明 ================================ //
    // ContextPath
    var sContextPath = _.CONTEXT_PATH;
    // 角色信息一览表格
    var oDataTable;
    
    $("#txtJE").get(0).focus();
    // ================================ 方法声明 ================================ //
    // JS插件渲染及画面初期事件绑定
    function initializePage() {
        var oDataTableOption = _.DATATABLES_OPTIONS;
        oDataTableOption.ajax = {
            url: _.resolvePath(sContextPath, 'api/roles'),
            data: function(oData) {
                $.extend(oData, $('form').serializeObject());
            }
        };

        oDataTableOption.columns = [ 
            {
                width: '80%',
                data: 'roleName'
            },
            
      ]

        oDataTableOption.columnDefs = [
            {
                createdCell: function(dTd, sData) {
                    $(dTd).attr('title', sData);
                },
                targets : [ 0]
            },
            {
                createdCell: function(dTd, sData, oData) {
                    var nId = oData.roleSeq;
                    var sBtn = '<a href="javascript:;"' + 'data-click="edit" data-click-data="'
                            + nId + '" title="编辑"><i class="fa fa-pencil"></i></a>';
                  
                        sBtn += '<a href="javascript:;" class="m-l"' + 'data-click="delete" data-click-data="'
                                + nId + '" title="删除"><i class="fa fa-trash"></i></a>';
   
                    $(dTd).html(sBtn);
                 },
                 targets : [ 1 ]
             }
         ]

        // 获取初始化表格
        oDataTable = $('#roleTbl').DataTable(oDataTableOption);

        // 事件绑定
        $('#roleTbl').delegate('a[data-click="delete"]', 'click', function() {
            var nId = $(this).data('clickData');
            $.alert(function(bConfirm) {
                if (bConfirm) {
                    // 提交至后台删除数据
                    var sUrl = _.resolvePath(sContextPath, 'api/role', nId);
                    $.del(sUrl).done(function() {
                        //显示处理成功
                        $.confirm();
                        //重新加载时不重置用户分页
                        oDataTable.ajax.reload(null, false);
                    });
                }
            });
        });

        $('#roleTbl').delegate('a[data-click="edit"]', 'click', function() {
            var nId = $(this).data('clickData');
            _.route(_.resolvePath(sContextPath, 'role', nId));
        });

        $('#addBtn').click(function() {
            _.route(_.resolvePath(sContextPath, 'role'));
        });

        $('#searchBtn').click(function() {
            oDataTable.ajax.reload();
        });

    }

    // 画面初期化
    function onPageLoad() {

        // 画面初期事件绑定及JS插件渲染
        initializePage();
    }

    // ================================ 方法调用 ================================ //
    // 画面初期化
    onPageLoad();
});
