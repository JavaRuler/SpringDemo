'use strict';
$(function() {

    // ================================ 变量声明 ================================ //
    // ContextPath
    var sContextPath = _.CONTEXT_PATH;
    // 公司信息一览表格
    var oDataTable;
    var nId = function() {
        if (location.pathname !== _.resolvePath(sContextPath, 'user')){
            var aslocatoin = location.pathname.split("/");
            // 获取 id
            return aslocatoin[aslocatoin.length - 1];
        }
    }();
	
    // ================================ 方法声明 ================================ //
    // JS插件渲染及画面初期事件绑定
    function initializePage() {
    	
    	if (nId != null) {
    		 /*var oDataTableOption = _.DATATABLES_OPTIONS;
             oDataTableOption.ajax = {
                 url: _.resolvePath(sContextPath, 'api/KeysUse', nId),
                 data: function(oData) {
                     $.extend(oData, $('form').serializeObject());
                 }
             };
             
             oDataTableOption.columns = [ 
                                         {
                                             width: '20%',
                                             data: 'holderNo'
                                         },
                                         {
                                             width: '20%',
                                             data: 'keyName'
                                         },                       
                                         {
                                             width: '20%',
                                             data: 'kbsSeqNo'
                                         },
                                         {
                                             width: '20%',
                                             data: 'tenpoSeqNo'
                                         }
                                   ]
                                   
                                   
             // 获取持有钥匙初始化表格
    		 oDataTable = $('#holderKeysTbl').DataTable(oDataTableOption);  */                    
                                   
                                   
    		 var oDataTableOption = _.DATATABLES_OPTIONS;
             oDataTableOption.ajax = {
                 url: _.resolvePath(sContextPath, 'api/userKeys', nId),
                 data: function(oData) {
                     $.extend(oData, $('form').serializeObject());
                 }
             };
             
             oDataTableOption.columns = [ 
                                         {
                                             width: '9%',
                                             data: 'tenpoNo'
                                         },
                                         {
                                             width: '9%',
                                             data: 'tenpoName'
                                         },                       
                                         {
                                             width: '9%',
                                             data: 'kbsSeqNo'
                                         },
                                         {
                                             width: '9%',
                                             data: 'kbsNo'
                                         },
                                         {
                                             width: '9%',
                                             data: 'holderNo'
                                         },
                                         {
                                             width: '9%',
                                             data: 'keyName'
                                         },
                                         {
                                             width: '9%',
                                             data: 'uset'
                                         },
                                         {
                                             width: '9%',
                                             data: 'manage'
                                         },
                                         {
                                             width: '9%',
                                             data: 'recognition'
                                         }
                                   ]
            
                                   
            oDataTableOption.columnDefs = [
    				{
    					createdCell : function(dTd, sData) {
    						$(dTd).attr('title', sData);
    					},
    					targets : [ 0, 1, 2, 3, 4 ,5]
    				},
    				{
    					createdCell : function(dTd, sData) {
    						var sHtml = '';
    						if(sData == "0"){
    							sHtml = '<i class="fa fa-check-circle" style="color:#337ab7"></i>';
    						}
    						$(dTd).html(sHtml);
    					},
    					targets : [ 6,7,8 ]
    				}

    		]
    	
    		// 承认钥匙初始化表格
    		oDataTable = $('#userKeysTbl').DataTable(oDataTableOption);

        	
    	}
        
    	
    	
        $('#backBtn').click(function() {
            back();
        });
    }

    // 跳回一览画面
    function back(){
        _.route(_.resolvePath(sContextPath, 'users'));
    }

    // 画面初期数据取得
    function getPageData() {
        if (nId != null) {
            var sUrl = _.resolvePath(sContextPath, 'api/orgByUserId/', nId);
            $.get(sUrl).done(function(oData) {
                $('#tenpoNo').val(oData.tenpoNo);
                $('#tenpoName').val(oData.tenpoName);
            });
        }
    }

    // 画面初期化
    function onPageLoad() {

        // 画面初期事件绑定及JS插件渲染
        initializePage();

        // 画面初期数据取得
        getPageData();
    }

    // ================================ 方法调用 ================================ //
    // 画面初期化
    onPageLoad();
});
