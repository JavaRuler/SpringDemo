'use strict';
$(function() {

    // ================================ 变量声明 ================================ //
    // ContextPath
    var sContextPath = _.CONTEXT_PATH;
    // 公司信息一览表格
    var oDataTable;
    // 人员信息一览表格
    var oDataTable1;
    
    $("#tenpoNo").get(0).focus();
    // ================================ 方法声明 ================================ //
    // JS插件渲染及画面初期事件绑定
    function initializePage() {
        var oDataTableOption = _.DATATABLES_OPTIONS;
        
		//机构一览
        oDataTableOption.ajax = {
            url: _.resolvePath(sContextPath, 'api/user/organizations'),
            data: function(oData) {
                $.extend(oData, $('form').serializeObject());
            }
        };

        oDataTableOption.columns = [ 
            {
                width: '30%',
                data: 'tenpoNo'
            },
            {
                width: '30%',
                data: 'tenpoName'
            }            
            /*{
                width: '25%',
                data: 'ipSeg'
            }*/
            /*,            
            {
                width: '15%',
                data: 'startDate'
            }
            ,            
            {
                width: '15%',
                data: 'endDate'
            }*/
      ]

        oDataTableOption.columnDefs = [
            {
                createdCell: function(dTd, sData) {
                    $(dTd).attr('title', sData);
                },
                targets : [ 0, 1 ]
            },
            {
                createdCell: function(dTd, sData, oData) {
                    var nId = oData.tenpoSeqNo;
                    var sBtn = '<a href="javascript:;"' + 'data-click="add" data-click-data="'
                            + nId + '" title="进入"><i class="fa fa-arrow-right"></i></a>';                  
                        
   
                    $(dTd).html(sBtn);
                 },
                 targets : [ 2 ]
             }
         ]

        // 获取初始化表格
        oDataTable = $('#orgnaizationTbl').DataTable(oDataTableOption);

        
        $('#orgnaizationTbl').delegate('a[data-click="add"]', 'click', function() {
            var nId = $(this).data('clickData');
            _.route(_.resolvePath(sContextPath, 'orgnaization', nId, 'users'));
        });
        
        
        
		//人员一览
        /*var oDataTableOption1 = _.DATATABLES_OPTIONS;
        oDataTableOption1.ajax = {
            url: _.resolvePath(sContextPath, 'api/users/org'),
            data: function(oData) {
                $.extend(oData, $('form').serializeObject());
            }
        };

        oDataTableOption1.columns = [ 
            {
                width: '25%',
                data: 'userName'
            },
            {
                width: '25%',
                data: 'tenpoNo'
            },
            {
                width: '25%',
                data: 'tenpoName'
            }
      ]

        oDataTableOption1.columnDefs = [
            {
                createdCell: function(dTd, sData) {
                    $(dTd).attr('title', sData);
                },
                targets : [ 0, 1, 2 ]
            },
            {
                createdCell: function(dTd, sData, oData) {
                    var nId = oData.tenpoSeqNo;
                    var uId = oData.userSeqNo;
                    var sBtn = '<a href="javascript:;"' + 'data-click="add" data-click-data="'
                            + nId + '" data-click-data1="'+ nId + '"  title="进入"><i class="fa fa-arrow-right"></i></a>';                  
                        
   
                    $(dTd).html(sBtn);
                 },
                 targets : [ 3 ]
             }
         ]

        // 获取初始化人员表格
        oDataTable1 = $('#userTbl').DataTable(oDataTableOption1);

        $('#userTbl').delegate('a[data-click="add"]', 'click', function() {
            var nId = $(this).data('clickData');
            var uId = $(this).data('clickData1');
            _.route(_.resolvePath(sContextPath, 'orgnaization', nId, 'users'));
        });*/

        

        $('#searchBtn').click(function() {
            oDataTable.ajax.reload();
            oDataTable1.ajax.reload();
        });

    }

    // 画面初期化
    function onPageLoad() {

        // 画面初期事件绑定及JS插件渲染
        initializePage();
    }

    // ================================ 方法调用 ================================ //
    // 画面初期化
    onPageLoad();
});
