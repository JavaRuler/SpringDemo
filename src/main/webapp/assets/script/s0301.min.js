'use strict';
$(function () {

    // ================================ 变量声明 ================================ //
    // ContextPath
    var sContextPath = _.CONTEXT_PATH;

    var oDataTable;
    
    $("#txtJE").get(0).focus();
    // ================================ 方法声明 ================================ //
    // JS插件渲染及画面初期事件绑定
    function initializePage() {
        // JS插件渲染渲染
        // 什么都不做

        var oDataTableOption = _.DATATABLES_OPTIONS;
        oDataTableOption.ajax = {
            url : _.resolvePath(sContextPath, 'api/keysUser'),
            data: function(oData) {
                $.extend(oData, $('form').serializeObject());
            }
        };

        oDataTableOption.columns = [ 
            {
                width: '15%',
                data: 'tenpoNo'
            },            
            {
                width: '15%',
                data: 'tenpoName'
            },            
            {
                width: '15%',
                data: 'kbsNo'
            },            
            {
                width: '15%',
                data: 'holderNo'
            },            
            {
                width: '15%',
                data: 'keyName'
            },            
            {
                width: '15%',
                data: 'keysyuName'
            }
      	]
      	
      	oDataTableOption.columnDefs = [
            {
                createdCell: function(dTd, sData) {
                    $(dTd).attr('title', sData);
                },
                targets : [ 0, 1, 2, 3, 4, 5 ]
            },
            {
                createdCell: function(dTd, sData, oData) {
                    var nId = oData.keySeqNo;
                    var sBtn = '&nbsp&nbsp<a href="javascript:;"' + 'data-click="move" data-click-data="'
                            + nId + '" title="进入"><i class="fa fa-arrow-right"></i></a>&nbsp&nbsp';
                  
                    $(dTd).html(sBtn);
                 },
                 targets : [ 6 ]
             }
         ]
      
      
      	// 获取初始化表格
        oDataTable = $('#dataTbl').DataTable(oDataTableOption);
        
        //事件绑定  迁移人信息详情
        $('#dataTbl').delegate('a[data-click="move"]', 'click', function() {
            var nId = $(this).data('clickData');
            _.route(_.resolvePath(sContextPath, 'search/key', nId));
        });


        $('#searchBtn').click(function() {
            oDataTable.ajax.reload();
        });
        
        $('#clearBtn').click(function(){
        	$('#tenpoNo').clearFields();
        	$('#tenpoName').clearFields();
        	$('#kbsNo').clearFields();
        	$('#holderNo').clearFields();
        	$('#keyName').clearFields();
        	$('#keysyuNo').clearFields();
        });
        
    }
    
    
    // 画面初期数据取得
    	function getPageData() {
            
            //钥匙类型
            var sUrlKeytype = _.resolvePath(sContextPath, 'api/key/keytypes');
            $.get(sUrlKeytype).done(function(oData) {
               
                //钥匙类型选择
                var keytypes = oData.keytypeMap;
                $('#keysyuNo').append("<option >全部</option>");
                for(var keytype in keytypes)  {
                	 $('#keysyuNo').append("<option value='"+ keytype +"'>"+ keytypes[keytype] +"</option>");
                }  
                
            });
            
            
        }
    

    // 画面初期化
    function onPageLoad() {

        // 画面初期事件绑定及JS插件渲染
        initializePage();
        
        // 画面初期数据取得
        getPageData();
    }

    // ================================ 方法调用 ================================ //
    // 画面初期化
    onPageLoad();
});