'use strict';
$(function() {

    // ================================ 变量声明 ================================ //
    // ContextPath
    var sContextPath = _.CONTEXT_PATH;
    // 机具信息一览表格
    var oDataTable;
    
	$("#kbsNo").get(0).focus();
    // ================================ 方法声明 ================================ //
    // JS插件渲染及画面初期事件绑定
    function initializePage() {

    		 var oDataTableOption = _.DATATABLES_OPTIONS;
             oDataTableOption.ajax = {
                 url: _.resolvePath(sContextPath, 'api/appmang/devices' ), 
                 data: function(oData) {
                     $.extend(oData, $('form').serializeObject());
                 }
             };
             
             oDataTableOption.columns = [ 
                                         {
                                             width: '20%',
                                             data: 'kbsNo'
                                         },
                                         {
                                             width: '20%',
                                             data: 'ipAddress'
                                         },            
                                         {
                                             width: '20%',
                                             data: 'connectPort'
                                         },
                                         {
                                             width: '20%',
                                             data: 'secchiName'
                                         }
                                         /*{
                                             width: '13%',
                                             data: 'startDate'
                                         },
                                         {
                                             width: '13%',
                                             data: 'endDate'
                                         },           
                                         {
                                             width: '20%',
                                             data: 'kbsStatus'
                                         }*/
                                   ]
             
    		 oDataTableOption.columnDefs = [
    				{
    					createdCell : function(dTd, sData) {
    						$(dTd).attr('title', sData);
    					},
    					targets : [ 0, 1, 2, 3 ]
    				},
    				{
    					createdCell : function(dTd, sData, oData) {
    						var kId = oData.kbsSeqNo;
    						var sBtn = '<a href="javascript:;"' + 'data-click="edit" data-click-data="'
                            + kId + '" title="进入"><i class="fa fa-arrow-right"></i></a>'; 
    						$(dTd).html(sBtn);
    					},
    					targets : [ 4 ]
    				} 
    		]

    		// 获取初始化表格
    		oDataTable = $('#deviceTbl').DataTable(oDataTableOption);

    		//迁移编辑画面
    		$('#deviceTbl').delegate('a[data-click="edit"]', 'click',	function() {
    			var kId = $(this).data('clickData');
    			_.route(_.resolvePath(sContextPath, 'appmang/device', kId));
    
    		});
    		
    		
    		 $('#searchBtn').click(function() {
    	            oDataTable.ajax.reload();
    	     });
    		 $('#refreshBtn').click(function() {
    	            oDataTable.ajax.reload();
    	     });
    	     
    }
   

    // 画面初期化
    function onPageLoad() {
    	
    	
        // 画面初期事件绑定及JS插件渲染
        initializePage();
    }

    // ================================ 方法调用 ================================ //
    // 画面初期化
    onPageLoad();
});
